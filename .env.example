# py-captions-for-channels Configuration
# Copy this file to .env and customize for your environment

# ==============================================================================
# CHANNELS DVR CONFIGURATION
# ==============================================================================

# Channels DVR API endpoint
# Default: http://localhost:8089
CHANNELS_API_URL=http://<CHANNELS_DVR_SERVER>:8089

# DVR recordings storage path (for Docker volume mount)
# This should be the path on the HOST machine where recordings are stored
# Default: /recordings
DVR_RECORDINGS_PATH=/tank/AllMedia/Channels

# Local test directory (for development only)
# When set, uses local sample files instead of network DVR repository
# Avoids VPN/network latency during testing
# Example: C:\Users\jay\source\repos\py-captions-for-channels\test-recordings
# Leave commented for production use
# LOCAL_TEST_DIR=

# ==============================================================================
# CHANNELWATCH CONFIGURATION
# ==============================================================================

# ChannelWatch WebSocket endpoint (usually not needed - webhooks are preferred)
# Default: ws://localhost:8501/events
CHANNELWATCH_URL=ws://<CHANNELWATCH_SERVER>:8501/events

# ==============================================================================
# EVENT SOURCE CONFIGURATION
# ==============================================================================

# Discovery mode: how the system learns about completed recordings
# "polling" - Polls Channels DVR API periodically (recommended, no setup needed)
# "webhook" - Receives webhooks from ChannelWatch (requires ChannelWatch setup)
# "mock" - Uses mock/test data (for development only)
# Default: webhook
DISCOVERY_MODE=webhook

# Legacy individual flags (deprecated - use DISCOVERY_MODE instead)
# USE_MOCK=false
# USE_POLLING=false  
# USE_WEBHOOK=true

# ==============================================================================
# POLLING SOURCE CONFIGURATION (when USE_POLLING=true)
# ==============================================================================

# Base polling interval in seconds
# Smart timing adjusts this: 60s near hour/:30, 300s otherwise
# Default: 120
POLL_INTERVAL_SECONDS=120

# Maximum number of recent recordings to fetch per poll
# Higher = catches more recordings but slower API calls
# Default: 50
POLL_LIMIT=50

# ==============================================================================
# WEBHOOK SERVER CONFIGURATION (when USE_WEBHOOK=true)
# ==============================================================================

# Host to bind webhook server to
# Default: 0.0.0.0 (all interfaces)
WEBHOOK_HOST=0.0.0.0

# Port for webhook server
# Default: 9000
# Configure in ChannelWatch as: json://<your-host-ip>:9000
WEBHOOK_PORT=9000

# ==============================================================================
# CAPTION PIPELINE CONFIGURATION
# ==============================================================================

# Transcode for Fire TV / Android clients (true/false)
# false: Only create .srt files (fast, ~1min per recording, works on Apple TV/Roku/Web)
# true: Transcode to MP4 with burned-in captions (slow, ~10-30min per recording, works on Fire TV/Android)
# Default: false
TRANSCODE_FOR_FIRETV=false

# Keep original recording as backup (true/false)
# true: Original .mpg file is archived as .mpg.orig after transcoding
# false: Original is deleted after successful transcoding (saves disk space)
# Note: Only applies when TRANSCODE_FOR_FIRETV=true
# Default: true
KEEP_ORIGINAL=true

# Caption command template
# {path} will be replaced with the recording file path
# Default (SRT only): bash -c 'whisper --model medium --output_format srt --output_dir "$(dirname "{path}")" "{path}"'
# For transcoding: /app/scripts/embed_captions.sh {path}
# Leave commented to use automatic default based on TRANSCODE_FOR_FIRETV setting
# CAPTION_COMMAND=/app/scripts/embed_captions.sh {path}

# Caption delay in milliseconds
# Shifts all caption timestamps forward by this amount to create a delay between audio and captions
# Useful for accessibility - some viewers prefer seeing captions slightly after hearing audio
# Range: 0-5000ms (0 = no delay, 1000 = 1 second delay)
# Default: 0
CAPTION_DELAY_MS=0

# Pipeline optimization mode (applies to both Whisper transcription and ffmpeg encoding)
# "standard": Use hardcoded parameters (default, proven reliable)
# "automatic": Detect encoding and optimize both Whisper and ffmpeg per recording (OTA vs TV Everywhere)
# Automatic mode runs ffprobe to analyze encoding and adjusts:
#   - Whisper: beam_size and VAD thresholds for transcription quality
#   - ffmpeg: encoder presets for faster encoding (30-50% speedup on OTA content)
# See docs/AUTOMATIC_WHISPER_OPTIMIZATION.md for details
# Default: standard
OPTIMIZATION_MODE=standard

# Dry-run mode: if true, only print commands without executing
# Default: false
DRY_RUN=false

# Pipeline timeout in seconds
# For SRT only: 3600 (1 hour) is usually sufficient
# For transcoding: 7200 (2 hours) recommended for long recordings
# Default: 7200
PIPELINE_TIMEOUT=7200

# Stale execution timeout in seconds (when running jobs should be marked failed)
# Default: matches PIPELINE_TIMEOUT
STALE_EXECUTION_SECONDS=7200

# ==============================================================================
# STATE AND LOGGING CONFIGURATION
# ==============================================================================

# State file location (for tracking processed recordings)
# Default: /app/data/state.json (Docker) or ./data/state.json (local)
STATE_FILE=/app/data/state.json

# Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
# Default: INFO
LOG_LEVEL=INFO

# ==============================================================================
# ADVANCED CONFIGURATION
# ==============================================================================

# DVR log file path (for log-based source, if implemented)
# Default: /var/log/channels-dvr.log
LOG_PATH=/share/CACHEDEV1_DATA/.qpkg/ChannelsDVR/channels-dvr.log

# API request timeout in seconds
# Default: 10
API_TIMEOUT=10

# Server timezone for "today" calculations
# All timestamps are stored in UTC, but calculations like job numbers reset at midnight
# in this timezone. Format: IANA timezone name (e.g., "America/New_York", "Europe/London")
# Default: System timezone
SERVER_TZ=
