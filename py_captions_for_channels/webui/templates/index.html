<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Py Captions Dashboard</title>
  <link rel="icon" type="image/png" sizes="16x16" href="/static/channels_cc_favicon_big/icon-16.png?v=3">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/channels_cc_favicon_big/icon-32.png?v=3">
  <link rel="icon" type="image/png" sizes="48x48" href="/static/channels_cc_favicon_big/icon-48.png?v=3">
  <link rel="icon" type="image/x-icon" href="/static/channels_cc_favicon_big/favicon.ico?v=3">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/channels_cc_favicon_big/icon-180.png">
  <link rel="manifest" href="/static/channels_cc_favicon_big/site.webmanifest" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header class="hero">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <img src="/static/channels_cc_favicon_big/icon-192.png" alt="Py Captions" style="width: 256px; height: 256px;" />
      <div>
        <p class="eyebrow">Py Captions</p>
        <h1>Real-time caption pipeline</h1>
        <p class="lede">Monitor jobs, logs, and system health from a single place.</p>
      </div>
    </div>
    <div class="pill">v0.9.0</div>
  </header>

  <main class="grid">
    <section class="card">
      <div class="card-head">
        <h2>Status</h2>
        <span id="status-pill" class="pill pill-muted">loading</span>
      </div>
      <table class="status-table">
        <tr>
          <td class="status-label">Application:</td>
          <td class="status-value"><span id="app-name">—</span>, <span id="app-version">—</span></td>
        </tr>
        <tr>
          <td class="status-label">Server Timezone:</td>
          <td class="status-value" id="timezone">—</td>
        </tr>
           <tr>
             <td class="status-label">Dry Run:</td>
             <td class="status-value" id="dry-run">—</td>
           </tr>
           <tr>
             <td class="status-label">Keep Original:</td>
             <td class="status-value" id="keep-original">—</td>
           </tr>
           <tr>
             <td class="status-label">Log Verbosity:</td>
             <td class="status-value" id="log-verbosity">—</td>
           </tr>
           <tr>
             <td class="status-label">Whisper Model:</td>
             <td class="status-value" id="whisper-model">—</td>
           </tr>
           <tr>
             <td class="status-label">Skip Caption Generation:</td>
             <td class="status-value" id="skip-caption-generation">—</td>
           </tr>
        <tr>
          <td class="status-label">Last Processed:</td>
          <td class="status-value value-sub" id="last-processed">—</td>
        </tr>
        <tr>
          <td class="status-label">Manual Process Queue:</td>
          <td class="status-value">
            <span id="manual-process-queue">0 items</span>
            <button onclick="showManualProcessModal()" class="btn-small" style="margin-left: 10px;">Manage</button>
          </td>
        </tr>
        <tr>
          <td class="status-label">Services:</td>
          <td class="status-value">
            <div id="services" class="services-container">
              <div class="service-status"><span class="service-unhealthy">●</span> Checking...</div>
            </div>
          </td>
        </tr>
        <tr>
          <td class="status-label">Heartbeat:</td>
          <td class="status-value">
            <div style="display: flex; gap: 12px; align-items: center;">
              <div style="display: flex; align-items: center; gap: 6px;">
                <span id="heartbeat-polling" class="heartbeat-indicator" title="API Polling">●</span>
                <span style="font-size: 12px; color: var(--muted);">Polling</span>
              </div>
              <div style="display: flex; align-items: center; gap: 6px;">
                <span id="heartbeat-manual" class="heartbeat-indicator" title="Manual Queue">●</span>
                <span style="font-size: 12px; color: var(--muted);">Manual</span>
              </div>
            </div>
          </td>
        </tr>
        <tr id="progress-row" style="display: none;">
          <td class="status-label">Progress:</td>
          <td class="status-value">
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <div id="whisper-progress-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                  <span style="font-size: 12px; color: var(--muted);">Whisper</span>
                  <span id="whisper-progress-text" style="font-size: 12px; color: var(--muted);">0%</span>
                </div>
                <div class="progress-bar">
                  <div id="whisper-progress-fill" class="progress-fill"></div>
                </div>
              </div>
              <div id="ffmpeg-progress-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                  <span style="font-size: 12px; color: var(--muted);">FFmpeg</span>
                  <span id="ffmpeg-progress-text" style="font-size: 12px; color: var(--muted);">0%</span>
                </div>
                <div class="progress-bar">
                  <div id="ffmpeg-progress-fill" class="progress-fill"></div>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </table>
    </section>

    <section class="card">
      <div class="card-head">
        <h2>Pipeline Settings</h2>
           <span id="webui-version" class="pill pill-muted" style="margin-left:10px;">webui v0.9.0+build1</span>
      </div>
      <form id="settings-form" onsubmit="saveSettings(event)">
        <div class="settings-group">
          <label for="dry-run-toggle">Dry Run</label>
          <input type="checkbox" id="dry-run-toggle" name="dry_run">
        </div>
        <div class="settings-group">
          <label for="keep-original-toggle">Keep Original</label>
          <input type="checkbox" id="keep-original-toggle" name="keep_original">
        </div>
        <div class="settings-group">
          <label for="log-verbosity-select">Log Verbosity</label>
          <select id="log-verbosity-select" name="log_verbosity">
            <option value="MINIMAL">Minimal</option>
            <option value="NORMAL">Normal</option>
            <option value="VERBOSE">Verbose</option>
          </select>
        </div>
        <div class="settings-group">
          <label for="whisper-model-select">Whisper Model</label>
          <select id="whisper-model-select" name="whisper_model">
            <option value="tiny">tiny</option>
            <option value="base">base</option>
            <option value="small">small</option>
            <option value="medium">medium</option>
            <option value="large">large</option>
          </select>
        </div>
        <div class="settings-group">
          <label for="whitelist-editor">Whitelist</label>
          <textarea id="whitelist-editor" name="whitelist" rows="8" style="width:100%"></textarea>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end;">
          <button type="submit" class="btn-primary">Save Settings</button>
        </div>
      </form>
    </section>
  </main>

  <section class="card logs-panel">
    <div class="card-head">
      <h2>Pipeline Activity</h2>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('executions')">Executions</button>
        <button class="tab-btn" onclick="switchTab('logs')">Full Logs</button>
      </div>
    </div>
    
    <div id="executions-tab" class="tab-content active">
      <div class="tab-header">
        <small class="muted" id="exec-count">(loading)</small>
        <div style="margin-left:auto; display:flex; gap:8px;">
          <button class="btn-small" onclick="clearList()">Clear List</button>
          <button class="btn-small" onclick="clearPendingExecutions()">Clear Pending</button>
        </div>
      </div>
      <ul class="exec-list" id="exec-list">
        <li class="muted">Loading executions...</li>
      </ul>
    </div>
    
    <div id="logs-tab" class="tab-content">
      <div class="tab-header">
        <small class="muted" id="log-count">(loading)</small>
      </div>
      <ul class="log-list" id="log-list">
        <li class="muted">Loading logs...</li>
      </ul>
    </div>
  </section>

    <!-- Modal for execution details -->
    <div id="exec-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title">Execution Details</h2>
          <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modal-body">
          <p class="muted">Loading...</p>
        </div>
      </div>
    </div>

    <!-- Modal for manual processing -->
    <div id="manual-process-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Manual Processing</h2>
          <button class="modal-close" onclick="closeManualProcessModal()">&times;</button>
        </div>
        <div class="modal-body">
           <div class="manual-process-controls">
             <p class="muted">Browse recordings from Channels DVR and select items to process:</p>
             <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
               <div class="settings-group">
                 <label for="manual-process-skip-caption">Skip Caption Generation</label>
                 <input type="checkbox" id="manual-process-skip-caption" name="skip_caption_generation">
               </div>
               <div class="settings-group">
                 <label for="manual-process-log-verbosity">Log Verbosity</label>
                 <select id="manual-process-log-verbosity" name="log_verbosity">
                   <option value="MINIMAL">Minimal</option>
                   <option value="NORMAL" selected>Normal</option>
                   <option value="VERBOSE">Verbose</option>
                 </select>
               </div>
             </div>
             <p class="muted" style="font-size: 0.9em; margin-top: -5px;">These settings will apply to all selected items.</p>
           </div>
          <div id="manual-process-list" style="max-height: 400px; overflow-y: auto;">
            <p class="muted">Loading candidates...</p>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end;">
            <button onclick="closeManualProcessModal()" class="btn-secondary">Cancel</button>
            <button onclick="submitManualProcessing()" class="btn-primary">Add Selected to Queue</button>
          </div>
        </div>
      </div>
    </div>

  <script src="/static/main.js"></script>
</body>
</html>
